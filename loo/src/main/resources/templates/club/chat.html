<!DOCTYPE html>
<html lang="ko">
<head th:replace="head :: head"></head>
<head>
	<title>동호회</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script>
		function update(comment_id){
			$.ajax({
				url: repleUpdate.html,
				success: function(data){
					console.log(data);
					$("#test").html(data);
				}
			});
		}
	</script>
</head>

<body>
	<div class="wrapper">
		<!-- 사이드 메뉴 -->
		<nav id="sidebar" class="sidebar js-sidebar">
			<div th:replace="sidebar :: login"></div>
		</nav>
		<!-- 상단 드롭다운 -->
		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
					<i class="hamburger align-self-center"></i>
    			</a>
				<div th:replace="dropdown :: login"></div>
			</nav>
			
			<main class="content">
				<div class="container-fluid p-0" th:object="${board}">
					<h1 class="h3 mb-3" th:text="*{board_title}"></h1>
					<div class="card">
						<div clss="card-header">
							<div class="float-end" style="margin: 10px;">
								<a href="/club/list" class="btn btn-sm btn-secondary mt-1">
									<i class="feather-sm" data-feather="menu"></i>
									Menu
								</a>
								<th:block th:if="${session.loginMember.member_mail == board.member_mail}">
									<a th:onclick="|location.href='/club/update?board_id=${board.board_id}'|" class="btn btn-sm btn-secondary mt-1">
										<i class="feather-md" data-feather="edit-3"></i>
										Edit
									</a>
									<a th:onclick="|location.href='/club/delete?board_id=${board.board_id}'|" class="btn btn-sm btn-secondary mt-1">
										<i class="feather-md" data-feather="trash-2"></i>
										Delete
									</a>
								</th:block>
							</div>
							<h5 class="text-center " th:text="*{board_contents}" style="margin: 20px;"></h5>
							<div></div>
						</div>
						<div class="card-body">
							<div class="row">
								<div class="col-12">
									<div class="card">
										<div class="card-body">
											<div class="d-flex align-items-start" id="test">
												<div class="flex-grow-1">
													<form action="writeComment" method="post" th:object="${newComment}">
														<input type="hidden" th:field="${board.board_category}">
														<input type="hidden" th:field="${board.board_id}">
														<textarea rows="2" class="form-control" th:field="*{comment_contents}" placeholder="글을 입력하세요."></textarea>
														<input type="submit" class="float-end btn btn-primary btn-sm" value="글 작성" style="margin-top: 10px;">
													</form>
												</div>
											</div>
											<!-- 수정버튼클릭 시 작성창에서 수정창으로 변경 -->
											<!--<div class="d-flex align-items-start" th:if="${param.comment_id}">
												<div class="flex-grow-1">
													<form action="updateComment" method="post" th:object="${updateComment}">
														<input type="hidden" th:field="${board.board_category}">
														<input type="hidden" th:field="*{comment_id}">
														<textarea rows="2" class="form-control" th:field="*{comment_contents}"></textarea>
														<input type="submit" class="float-end btn btn-primary btn-sm" value="댓글 수정" style="margin-top: 10px;">
													</form>
												</div>
											</div>-->
											<th:block th:each="comments : ${comments}">
												<hr/>
												<div class="d-flex align-items-start">
													<img th:if="${comments.saved_filename}" th:src="@{'/img/upload/' + ${comments.saved_filename}}" class="avatar img-fluid rounded me-1" width="36" height="36"/>
	    											<img th:unless="${comments.saved_filename}" src="/img/avatars/profile.png" class="avatar img-fluid rounded me-1" width="36" height="36"/>
													<div class="flex-grow-1">
														<strong th:text="${comments.member_name}"></strong>
														<div th:if="${session.loginMember.member_mail == comments.member_mail}" class="float-end">
															<a th:onclick="update(${comments.comment_id})">
																<i class="feather-sm" data-feather="edit-3"></i>
															</a>
															<a th:onclick="|location.href='/club/deleteComment?comment_id=${comments.comment_id}'|">
																<i class="feather-sm" data-feather="trash-2"></i>
															</a>
														</div><br />
														<small class="text-muted" th:text="${#temporals.format(comments.comment_create_time, 'yyyy-MM-dd HH:mm')}"></small>
														<small th:if="${comments.comment_edit_time != null}" class="text-muted" th:text="' / ' + ${#temporals.format(comments.comment_edit_time, 'yyyy-MM-dd HH:mm')} + ' 수정'"></small><br />
														<div class="flex-shrink-1 bg-light rounded py-2 px-3 me-3" th:text="${comments.comment_contents}"></div>
													</div>
												</div>
											</th:block>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>

		</div>
	</div>

	<script src="/js/app.js"></script>

</body>

</html>