<!DOCTYPE html>
<html lang="ko">

<head th:replace="head :: head"></head>

<head>
	<title>스케줄</title>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.js'></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.9/index.global.min.js"></script>

	<script th:inline="javascript">
		document.addEventListener('DOMContentLoaded', function () {
			var object = [[${schedule}]]
			var objects = [[${schedules}]]
			var allObject = [[${allschedules}]]
			var calendarEl = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendarEl, {
			
			googleCalendarApiKey: 'AIzaSyAgGNHIbmXLXhRPanmc-xAAt_qdwPxHUOk',
			
				
				initialView: 'dayGridMonth',
				initialDate: new Date(),
				locale: 'ko',
				expandRows: true,
				contentHeight: 500,
				headerToolbar: {
					left: 'prev,next',
					center: 'title',
					right: 'dayGridMonth,timeGridWeek'
				},
		
				/* 마우스 올렸을 때 내용보이기(수정을 할수없어서 보류) eventDidMount: function (info) {
					for (var i = 0; i < object.length; i++) {
						if (info.event.title === object[i].schedule_name) {
							tippy(info.el, {
								content: object[i].schedule_contents,
								placement: 'top',
								offset: [0, 0],
								// interactive: true,	
							});
						}
					}
				}, */

				navLinks: true,
				fixedWeekCount: false, // 이전달 다음달 선택 막기 
				eventSources: [

					// 개인일정 갖고오기
					{
						events: function (info, successCallback, failureCallback) {
							var events = [];
							for (var i = 0; i < object.length; i++) {
								events.push({
									"start": object[i].schedule_date,
									"end": object[i].deadline,
									"title": object[i].schedule_name,

								});
							}
							successCallback(events)
						},
						color : "#ff385c"
                    , textColor : "white"

					},
					// 회사일정 갖고오 
					{
						events: function (info, successCallback, failureCallback) {
							var events = [];
							for (var i = 0; i < objects.length; i++) {
								events.push({
									"start": objects[i].schedule_date,
									"end": objects[i].deadline,
									"title": objects[i].schedule_name,

								});
							}
							successCallback(events)
						},
						color: 'blue',
						textColor: 'white',

					},
					
					
					{ 
						events : {
						googleCalendarId : 'ko.south_korea#holiday@group.v.calendar.google.com',
						color : 'white',
						textColor : 'red'
							
						}	
					}
				],

				dateClick: function (info) {
					console.log("일정클릭")
					console.log(info);
					Swal.fire({
						title: '일정 입력하기',
						html: `
							<label for="sch">일정명</label>
							<input type="text" id="sch" class="form-control form-control-lg" name="schedule_name"><p><p>
							<label for="con">상세설명</label>
  							<input type="text" id="con" class="form-control form-control-lg" name="schedule_contents"><p>
  							<label for="sta">시작일</label>
  							<input type="date" id="sta" class="form-control form-control-lg" name="schedule_date" value="${info.dateStr}"><p>
						    <label for="sta">마감일</label>
  							<input type="date" id="ded" class="form-control form-control-lg" name="deadline"><p>
  							<label for="typ">일정종류</label>
  							<select class="form-select mb-3" name="schedule_type" id="typ">
							   <option value="null" selected>일정종류를 선택해주세요.</option>
                               <option value="personal">개인</option>
                               <option value="company">사내</option>
							</select>	  
  							<label for="imp">중요도</label>
  							<select class="form-select" name="importance" id="imp">
                               <option value="null" selected>중요도를 선택해주세요.</option>
                               <option value="normal">보통</option>
                               <option value="important">중요</option>
                               <option value="easy">간단</option>
                             </select>
  							`,

						confirmButtonText: '등록하기'
					}).then((result) => {
						if (result.isConfirmed) {
							const url = "/schedule/list";
							const data = {
								schedule_name: $('#sch').val(),
								schedule_contents: $('#con').val(),
								schedule_date: $('#sta').val(),
								deadline: $('#ded').val(),
								importance: $('#imp').val(),
								schedule_type : $('#typ').val()
							};
							$.ajax({
								url: url,
								type: "POST",
								data: data,
								success: function (result) {
									Swal.fire(
										'일정이 등록되었습니다'
									).then(() => {
										location.reload();
									})
								}
							})

						}
					})
				},

				eventClick: function (info) {
					var 누른거 = allObject.find(function (event) {
						return event.schedule_name === info.event._def.title;
						console.log(누른거)
					});

					Swal.fire({
						title: '일정 확인하기',
						html: `
				            <label for="sch">일정명</label>
				            <input type="text" id="sch" class="form-control form-control-lg" value="${누른거.schedule_name}" disabled><p><p>
				            <label for="con">상세설명</label>
				            <input type="text" id="con" class="form-control form-control-lg" value="${누른거.schedule_contents}" disabled><p>
				            <label for="sta">시작일</label>
				            <input type="text" id="sta" class="form-control form-control-lg"  value="${누른거.schedule_date}" disabled><p>
				            <label for="sta">마감일</label>
				            <input type="text" id="ded" class="form-control form-control-lg"  value="${누른거.deadline}" disabled><p>
							<labe for="typ">일정종류</label>
							<input type="text" id="typ" class="form-control form-control-lg" value="${누른거.schedule_type}" disabled><p>
				            <label for="imp">중요도</label>
				            <input type="text" id="imp" class="form-control form-control-lg" value="${누른거.importance}" disabled>
           
        `,
						confirmButtonText: '삭제하기'
					}).then((result)=>{
						if(result.isConfirmed){
							const url = "/schedule/delete";
							const data = {
								schedule_name : $('#sch').val() // 스케줄 이름 보내서 지울떄 쓸려고 
							}
						
						
						$.ajax({
							url : url,
							method : "POST",
							data : data,
							success: function (result) {
									Swal.fire(
										'일정이 삭제되었씁니다'
									).then(() => {
										location.reload();
									})
								}
						}) 
						}
					})
				}


			});
			calendar.render();
		});

	</script>
</head>

<body>
	<div class="wrapper">
		<!-- 사이드 메뉴 -->
		<nav id="sidebar" class="sidebar js-sidebar" th:if="${session.loginMember}">
			<div th:replace="sidebar :: login"></div>
		</nav>
		<!-- 상단 드롭다운 -->
		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg" th:if="${session.loginMember}">
				<a class="sidebar-toggle js-sidebar-toggle">
					<i class="hamburger align-self-center"></i>
				</a>
				<div th:replace="dropdown :: login"></div>
			</nav>



			<main class="content">
				<div class="container-fluid">
					<div class="card">
						<div class="card-body">
							<div class="row">
								<div class="card-header">
									<h5 class="card-title mb-0">일정관리</h5>
								</div>
								<div id='calendar'></div>

							</div>
						</div>
					</div>

				</div>
		</div>
	</div>
	</main>
	</div>
	</div>

	<script src="/js/app.js"></script>

</body>

</html>