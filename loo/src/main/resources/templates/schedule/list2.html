<!DOCTYPE html>
<html lang="ko">

<head th:replace="head :: head"></head>

<head>
	<title>스케줄</title>
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.js'></script>
	<script src="https://unpkg.com/@popperjs/core@2"></script>
	<script src="https://unpkg.com/tippy.js@6"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>

	<script th:inline="javascript">
		var object = [[${schedules}]]

		console.log(object[0].schedule_id);
		document.addEventListener('DOMContentLoaded', function () {
			var calendarEl = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendarEl, {
				initialView: 'dayGridMonth',
				initialDate: new Date(),
				locale: 'ko',
				expandRows: true,
				contentHeight: 500,

				headerToolbar: {
					left: 'prev,next',
					center: 'title',
					right: 'dayGridMonth,timeGridWeek'
				},
				eventDidMount: function (info) {
					for (var i = 0; i < object.length; i++) {
						if (info.event.title === object[i].schedule_name) {
							tippy(info.el, {
								content: object[i].schedule_contents,
								placement: 'top',
								offset: [0, 0],
								// interactive: true,	
							});
						}	
					}
				},

				navLinks: true,
				fixedWeekCount: false, // 이전달 다음달 선택 막기 
				eventSources: [

					// 첫번째 이벤트
					{
						events: function (info, successCallback, failureCallback) {
							var events = [];
							for (var i = 0; i < object.length; i++) {
								events.push({
									"start": object[i].schedule_date,
									"end": object[i].deadline,
									"title": object[i].schedule_name,

								});
							}
							successCallback(events)
						},

						textColor: 'black',

					},
					// 두번째 이벤트 
					{

					}
				],

				dateClick: function (info) {
					console.log("일정클릭")
					console.log(info);
			   
                $('#calendarModal').modal();
				}
			});
			calendar.render();
		});

	</script>
</head>

<body>
	<div class="wrapper">
		<!-- 사이드 메뉴 -->
		<nav id="sidebar" class="sidebar js-sidebar" th:if="${session.loginMember}">
			<div th:replace="sidebar :: login"></div>
		</nav>
		<!-- 상단 드롭다운 -->
		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg" th:if="${session.loginMember}">
				<a class="sidebar-toggle js-sidebar-toggle">
					<i class="hamburger align-self-center"></i>
				</a>
				<div th:replace="dropdown :: login"></div>
			</nav>



			<main class="content">
				<div class="container-fluid">
					<div class="card">
						<div class="card-body">
							<div class="row">
								<div class="card-header">
									<h5 class="card-title mb-0">일정관리</h5>
								</div>
								<div id='calendar'></div>
								<div id="createEventModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Add Event</h4>
      </div>
      <div class="modal-body">
            <div class="control-group">
                <label class="control-label" for="inputPatient">Event:</label>
                <div class="field desc">
                    <input class="form-control" id="title" name="title" placeholder="Event" type="text" value="">
                </div>
            </div><br>
            
            <input type="hidden" id="startTime"/>
            <input type="hidden" id="endTime"/>           
                   
        <div class="control-group" style="display:none;">
            <label class="control-label" for="when">When:</label>
            <div class="controls controls-row" id="when" style="margin-top:5px;">
            </div>
        </div>
        
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button type="submit" class="btn btn-primary" id="submitButton">Save</button>
    </div>
    </div>

  </div>
</div>


<div id="calendarModal" class="modal fade">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Event Details</h4>
        </div>
        <div id="modalBody" class="modal-body">
        <h4 id="title" class="modal-title"></h4>
        <div id="modalWhen" style="margin-top:5px;"></div>
        </div>
        <input id="eventID"/>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
            <button type="submit" class="btn btn-danger" id="deleteButton">Delete</button>
        </div>
    </div>
</div>
</div>
							</div>
						</div>
					</div>
				
				</div>
		</div>
	</div>
	
	</main>

	</div>
	</div>

	<script src="/js/app.js"></script>

</body>

</html>